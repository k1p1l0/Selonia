<!DOCTYPE html>
<html>
	<head>
		<title>Emails</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body>
	<div class="container content">
		<div class="row">
			<div class="col-lg-8">
				<div class="loader"></div>
				<table class="table table-hover animate-bottom" id="main-table">
					<thead>
						<tr>
							<th>#</th>
							<th>Name</th>
							<th>Email</th>
							<th>Template</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						<tr></tr>
					</tbody>
					<tfoot>
						<tr class="success">
							<td colspan="2">
								<input type="text" class="form-control" id="nameInput" placeholder="Name input">
							</td>
							<td>
								<input type="text" class="form-control" id="emailInput" placeholder="Email input">
							</td>
							<td colspan="2">
								<button type="button" class="btn btn-success" id="addOne" style="width: 100%">Add</button>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
			<div class="col-lg-4">

			<div class="panel panel-default">
  		<div class="panel-heading">Global actions</div>
  			<div class="panel-body">
  				<div class="row">
  					<div class="col-lg-8">
							<select name="templates" class="form-control">
						    <option disabled selected>Choose template</option>
						    <option value="origin">Origin</option>
						    <option value="new">New</option>
							</select>
  					</div>
  					<div class="col-lg-4">
  						<button type="button" class="btn btn-primary">Send to all</button>
  					</div>
  				</div>
  			</div>
			</div>

			<div class="panel panel-default">
			 <div class="panel-heading">Upload recipients</div>
  			<div class="panel-body">
  				<div class="row">
  					<div class="col-lg-8">
							 <div class="form-group">
							    <input type="file" id="csvUpload">
							    <p class="help-block">Must be .csv file (name, email)</p>
  							</div>
  					</div>
  					<div class="col-lg-4 text-center">
  						<button type="button" class="btn btn-primary">Upload</button>
  					</div>
  				</div>		
  			</div>
			</div>

			<div class="panel panel-default">
			 <div class="panel-heading">Add template</div>
  			<div class="panel-body">
  				<div class="row">
  					<div class="col-lg-8">
							 <div class="form-group">
							    <input type="file" id="exampleInputFile">
							    <p class="help-block">Must be in .zip and have only html.ejs</p>
  							</div>
  					</div>
  					<div class="col-lg-4 text-center">
  						<button type="button" class="btn btn-primary">Add</button>
  					</div>
  				</div>		
  			</div>
			</div>

			</div>
		</div>
	</div>

	<script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
	<script type="text/javascript">
		const API_URL = 'https://3j5zptrz4m.execute-api.us-east-1.amazonaws.com/prod/recipients';
		$(() => {
			$.ajax({
				type: 'GET',
				url: API_URL,

				success: function(data) {
					data.Items.forEach((item, i) => {
						$('.loader').hide();
						$('#main-table').show();
						$('#main-table tbody tr:last').after
						(`
							<tr>
								<td>${i+1}</td>
								<td>${item.name}</td>
								<td>${item.email}</td>
								<td>
									<select name="templates" class="form-control">
								    <option disabled selected>Choose template</option>
								    <option value="origin">Origin</option>
								    <option value="new">New</option>
							   	</select>
								</td>
								<td>
									<button type="button" class="btn btn-success">Send</button>
									<button type="button" class="btn btn-danger">Delete</button>
								</td>
							</tr>
						`);
					});
				}
			})
		});

		$('#addOne').on('click', () => {
			$.ajax({
				type: 'POST',
				url: API_URL,
				data: JSON.stringify({
					"recipients": [{
						"name": $('#nameInput').val(),
						"email": $('#emailInput').val()
					}]
				}),
				contentType: "application/json",
				success: function() {
					location.reload();
				}
			});
		});
	</script>
	</body>
</html>